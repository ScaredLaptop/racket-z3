## Racket × Z3 bindings (work‑in‑progress)

This repository provides **Racket bindings for the Z3 SMT solver**.  
All exposed bindings to the Z3 C‑API are auto‑generated into Racket FFI stubs, and a small abstraction sits on top of it. Anything prefixed by _ (and in ffi/ directory) is autogenerated and directly interfaces with C. 

---

## Directory tour

| Path | What lives here | Notes |
|------|-----------------|-------|
| `bindgen/` | Scripts + header snapshots used to regenerate the FFI layer (`gen.py`, downloaded `z3_api*.h`) | Run `python gen.py` after bumping Z3 to re‑emit Racket stubs |
| `racket-z3-lib/ffi/` | **Auto‑generated** `_Z3_*` bindings (`functions.rkt`, `types.rkt`, `enums.rkt`)
| `racket-z3-lib/` | Hand‑written, higher‑level helpers (`context.rkt`, `vars.rkt`, `print.rkt`, …) | Preferred user API – still evolving |
| `racket-z3-test/` | RackUnit test‑suite which tests the auto-generated bindings (`smoke-ffi.rkt`) and has some limited test coverage for the helpers. 
| `racket-z3-doc/` | (future) Scribble documentation | |

---

## Quick start
# Requires Racket ≥8.10 and Z3 shared library on PATH
```console
export Z3_LIB_PATH="/opt/homebrew/lib/libz3.dylib"
git clone https://github.com/ScaredLaptop/racket-z3.git && cd racket-z3
raco pkg install --auto  
raco test racket-z3-test/smoke-ffi.rkt
```

### Basic example

```racket
#lang racket
(require racket-z3-lib/context
         racket-z3-lib/vars)

(define ctx (mk-proof-context))
(define x   (bool "x" ctx))
(define s   (solver ctx))
(s:assert s x)        ; assert x
(displayln (s:check s)) ; => Z3_L_TRUE
(s:del) (del-context ctx)
```

---

## Regenerating the FFI layer

```
cd bindgen
python gen.py ../racket-z3-lib/ffi
```

`gen.py` …

1. Downloads the canonical Z3 headers at the commit pinned in the script.
2. Parses them and emits three Racket files (`functions.rkt`, `types.rkt`, `enums.rkt`) using the mapping table in the script.  
3. Drops the files into `racket-z3-lib/ffi/`, ready for `raco setup`.

---

## Development notes

### Loading the native library

The stubs rely on `ffi-lib` to locate `libz3` at runtime. If it isn’t on your platform’s default search path set the env Z3_LIB_PATH.

### Testing

* **RackUnit** drives all tests.
* Smoke tests pull the *latest* upstream C‑example on every run and makes sure there's no missing symbols; tests are adapted from https://github.com/Z3Prover/z3/blob/master/examples/c/test_capi.c
* Aim to expand coverage with arrays, bit‑vectors, FP, etc.


## License

This project is distributed under the MIT License (see `LICENSE`). Z3 itself is available under the MIT License as well.

---

Happy proving!